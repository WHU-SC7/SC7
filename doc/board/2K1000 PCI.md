使用下面函数扫描pci设备


首先是qemu -M ls2k:
id: 7a030014
id: 7a040014
id: 7a150014
id: 7a060014
id: 26688086
id: 7a080014  // sata控制器,模拟器也有
id: d5df53
id: d5df53
id: d5df53
id: d5df53
id: 10d38086
id: 1941033

然后是2K1000星云板:
id: 7a020014                                                                    
id: 7a030014                                                                    
id: 7a040014                                                                    
id: 7a050014                                                                    
id: 7a060014                                                                    
id: 7a070014                                                                    
id: 7a080014  // sata控制器                                                                  
id: 7a190014                                                                    
id: 7a090014                                                                    
id: 7a0f0014                                                                    
id: 7a160014                                                                    
id: 7a260014

# 扫描sata信息
首先是loader的
PCI Device at bus: 0, device: 8, function: 0
  Vendor ID: 14, Device ID: 7a08
  Header Type: 80
  Command: 7, Status: 10
  Class Code: 10601, Revision ID: 2
  BAR0: Address: 400e0000, Length: fffff000
  Card Bus Pointer: 0
  Subsystem Vendor ID: 1af4, Subsystem Device ID: 1100
  Expansion ROM Base Address: 0
  Capability List: a8
  Interrupt: Line: 1b, Pin: 1
  Min GNT: 0, Max LAT: 0

然后是ai写的
SATA Controller Information:
  Vendor ID: 14, Device ID: 7a08
  Header Type: 80
  Command: 7, Status: 10
  Class Code: 10601, Revision ID: 2
  BAR0 Original: 400e0000
    BAR0 Type: MMIO, Length: 1000
  BAR1 Original: 0
  BAR2 Original: 0
  BAR3 Original: 0
  BAR4 Original: 0
  BAR5 Original: 0
  Subsystem Vendor: 1af4, Subsystem Device: 1100
  Expansion ROM Base: 0
  Capability Pointer: a8
  IRQ Line: 1b, IRQ Pin: 1

上面是在qemu -M ls2k跑的，在板子上略有不同:
SATA Controller Information:                                                    
  Vendor ID: 14, Device ID: 7a08                                                
  Header Type: 0                                                                //有变化
  Command: 7, Status: 0                                                         
  Class Code: 10601, Revision ID: 0                                             
  BAR0 Original: 400e0004                                                       //这个怎么也不一样
    BAR0 Type: MMIO, Length: 10000                                              
  BAR1 Original: 0                                                              
  BAR2 Original: 0                                                              
  BAR3 Original: 0                                                              
  BAR4 Original: 0                                                              
  BAR5 Original: 0                                                              
  Subsystem Vendor: 0, Subsystem Device: 0                                      
  Expansion ROM Base: 0                                                         
  Capability Pointer: 0                                                         
  IRQ Line: ff, IRQ Pin: 0                                                      // 有变化

# 初始化
SATA Controller Information:                                                    
  Vendor ID: 14, Device ID: 7a08                                                
  Header Type: 0                                                                
  Command: 7, Status: 0                                                         
  Class Code: 10601, Revision ID: 0                                             
  BAR0 Original: 400e0004                                                       
    BAR0 Type: MMIO, Length: 10000                                              
  BAR1 Original: 0                                                              
  BAR2 Original: 0                                                              
  BAR3 Original: 0                                                              
  BAR4 Original: 0                                                              
  BAR5 Original: 0                                                              
  Subsystem Vendor: 0, Subsystem Device: 0                                      
  Expansion ROM Base: 0                                                         
  Capability Pointer: 0                                                         
  IRQ Line: ff, IRQ Pin: 0                                                      
Starting SATA Controller Initialization...                                      
HBA Base Address: 400e0000                                                      
AHCI Capabilities:                                                              
  Supports 64-bit: 1                                                            
  Number of Ports: 32                                                           
  Command Slots: 1                                                              
Initial HBA Control: 80000002                                                   
HBA Ready. Current Control: 80000002                                            
Cleared Interrupt Status: 0                                                     
Implemented Ports: 1                                                            
                                                                                
Initializing Port 0...                                                          
  Stopping Port DMA Engine...                                                   
  Cleared Port Error Status: 123                                                
  Starting Port DMA Engine...                                                   
  Port 0 Status: 123 (Detected: 1, Speed: Gen2 (3Gbps))                         
  Port 0 Signature: 101 (Type: ATA)                                             
                                                                                
SATA Initialization Complete!