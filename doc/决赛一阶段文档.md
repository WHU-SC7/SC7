# 工作汇报
从7月份开始，我们主要做的工作为：
1. RISC-V、Loongarch支持多核启动
2. 实现进程组管理，新增权限管理，新增UID/GID权限体系，支持umask权限掩码，实现了包括setpgid/getpgid
3. 线程模型重构， 完善futex和线程信号量机制
4. 完善内存管理，实现共享内存机制，优化mmap支持MAP_PRIVATE写时复制
5. 虚拟文件系统实现procfs（/proc/self/stat、/proc/cpuinfo等）
6. 扩展lwext4文件操作,支持目录项为符号链接，支持ftruncate文件扩容
7. 信号与中断处理，实现线程级信号处理
8. 新增系统调用，通过lmbench和部分ltp测试


# 上板文档
## VF2
### 上传镜像
先把板子uart用转换器连到电脑usb口
安装minicom
sudo minicom -D /dev/ttyUSB0 -b 115200
uboot启动后，先loady 0x80200000
然后按ctrl + A， 按Shift + S，选择ymod传输
传输界面中选择内核镜像bin文件
传输完成后输入go 0x80200000，控制流就转交给内核

或者使用tftp传输，速度快

### 磁盘
插入sd卡后
使用 fdisk 重新分区：sudo fdisk /dev/sda
在 fdisk 交互界面：
    输入 d 删除分区（可能需要删除两次，因为有两个分区 sda1 和 dev/sda2）。
    输入 n 创建新分区：
        选择 p（主分区）
        分区号 1（默认）
        起始扇区 2048（默认）
        结束扇区 +29G（或者直接回车，使用全部空间）
    输入 t 更改分区类型：
        选择 83（Linux 文件系统）
    输入 w 保存并退出。

然后格式化为 ext4
sudo mkfs.ext4 /dev/sda1 -b 4096

如果挂载sda1，
sudo mount /dev/sda1 mnt_sd
如果需要更改权限
sudo chown -R $USER:$USER mnt_sd

### 制作SC7使用的文件系统
1. 按照上面步骤，在sd卡创建一个空的ext4文件系统的区
[可选] 复制一个busybox(glibc,musl皆可)到根目录,这样可以在第一次启动SC7时进行简单的文件操作和检查
2. 然后插入sd卡到Visionfive，第一次启动SC7。SC7会初始化设备文件，系统文件和一些目录
3. 然后取下sd卡，在电脑上复制官方磁盘映像的musl下的文件到sd卡的musl下
4. 插入sd卡到Visionfive，第二次启动SC7。

## LS2K
### LS2K上板文档
通过tftp上传，需要网线连接
和Visionfive类似，上电后自动进入uboot，可以通过uart串口交互
按照XN6的文档配置minicom后会方便很多，具体为:
1. 输入minicom -s，在串口设置中，修改串行设备为/dev/ttyUSB0
2. 选择保存设置为dfl。然后可以修改创建的dfl文件，加入"pu addcarreturn    Yes",实现自动换行
3. 启动时加参数-con，支持颜色显示

### 上传镜像的准备
在uboot输入
setenv serverip 192.168.1.2
之后在电脑(假设是ubuntu 24)，设置中的有线连接，更改IPv4方式为手动，地址为上面的地址，子网掩码为255.255.255.0

还要安装并开启tftp服务器
sudo apt install tftpd-hpa
sudo service tftpd-hpa start
默认开启正常

然后在LS2K就可以ping到192.168.1.2，并且可以传文件了

### 上传命令
为了方便，设置变量addr为内核起始地址
setenv addr 0x9000000090000000
已经使用saveenv保存在SPI flash中

然后使用命令下载镜像到指定地址
tftpboot ${addr} ls2k.bin
下载成功后，使用命令启动到内核
go ${addr}

目前的进度到虚拟内存，正在攻克

### 上传文件系统镜像
把文件系统镜像放到/srv/tftp，然后

tftpboot ${addr} sdcard-rv.img

注意2K1000板子只有2G内存，不能一次上传太大的文件系统镜像。然后

scsi write $(addr) 0x0 0x40000

0x0表示从0扇区开始，0x40000表示写入这么多个扇区。然后就烧写完了



